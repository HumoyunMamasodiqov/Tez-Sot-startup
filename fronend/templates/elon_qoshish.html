<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yangi e'lon qo'shish - Tez Sot</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    <script>
    tailwind.config = {
    theme: {
    extend: {
    colors: {
    primary: '#8B5CF6',
    secondary: '#7C3AED'
    },
    borderRadius: {
    'none': '0px',
    'sm': '4px',
    DEFAULT: '8px',
    'md': '12px',
    'lg': '16px',
    'xl': '20px',
    '2xl': '24px',
    '3xl': '32px',
    'full': '9999px',
    'button': '8px'
    }
    }
    }
    }
    </script>
    <style>
    :where([class^="ri-"])::before {
    content: "\f3c2";
    }
    .theme-transition {
    transition: all 0.3s ease;
    }
    .light-mode {
    --bg-primary: #FFFFFF;
    --bg-secondary: #F9FAFB;
    --text-primary: #333333;
    --text-secondary: #6B7280;
    --border-color: #C4B5FD;
    --hover-color: #7C3AED;
    }
    .dark-mode {
    --bg-primary: #1A1A1A;
    --bg-secondary: #2D2D2D;
    --text-primary: #FFFFFF;
    --text-secondary: #D1D5DB;
    --border-color: #6D28D9;
    --hover-color: #A78BFA;
    }
    body {
    background-color: var(--bg-primary);
    color: var(--text-primary);
    }
    .custom-input {
    background-color: var(--bg-primary);
    border: 2px solid var(--border-color);
    color: var(--text-primary);
    transition: all 0.3s ease;
    }
    .custom-input:focus {
    outline: none;
    border-color: #FFD700;
    box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
    }
    .custom-toggle {
    position: relative;
    display: inline-block;
    width: 48px;
    height: 24px;
    }
    .custom-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
    }
    .toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 24px;
    }
    .toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    input:checked + .toggle-slider {
    background-color: #8B5CF6;
    }
    input:checked + .toggle-slider:before {
    transform: translateX(24px);
    }
    .upload-zone {
    border: 2px dashed var(--border-color);
    background-color: var(--bg-secondary);
    transition: all 0.3s ease;
    }
    .upload-zone:hover {
    border-color: #FFD700;
    background-color: rgba(255, 215, 0, 0.05);
    }
    .image-preview {
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-color);
    }
    .theme-toggle {
    position: fixed;
    top: 2rem;
    right: 2rem;
    z-index: 50;
    }
    </style>
</head>
<body class="light-mode theme-transition min-h-screen">
    {% load static %}
    
    <div class="theme-toggle">
        <button id="themeToggle" class="w-12 h-12 flex items-center justify-center rounded-full bg-primary text-white hover:bg-secondary transition-all duration-300">
            <i class="ri-sun-line ri-lg"></i>
        </button>
    </div>

    {% include 'nav.html' %}

    <div class="max-w-6xl mx-auto p-8 pt-20">
        <div class="mb-8 flex justify-between items-center">
            <div>
                <h1 class="text-4xl font-bold text-primary mb-2">Yangi e'lon qo'shish</h1>
                <p class="text-lg" style="color: var(--text-secondary)">Yangi mahsulot ma'lumotlarini kiriting</p>
            </div>
            <a href="{% url 'mahsulotlar' %}">
                <button type="button" class="w-[150px] h-[50px] rounded-button border-2 border-primary text-primary hover:bg-primary hover:text-white transition-all duration-300 font-medium whitespace-nowrap">
                    Orqaga qaytish
                </button>
            </a>
        </div>

        {% if messages %}
            <div class="mb-6 space-y-2">
                {% for message in messages %}
                    <div class="p-4 rounded-lg {% if message.tags == 'error' %}bg-red-100 text-red-700 border border-red-300{% else %}bg-green-100 text-green-700 border border-green-300{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <form method="POST" enctype="multipart/form-data" class="space-y-8">
            {% csrf_token %}
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Chap qism -->
                <div class="space-y-6">
                    <!-- Asosiy ma'lumotlar -->
                    <div>
                        <label class="block text-sm font-semibold mb-3" style="color: var(--text-primary)">Mahsulot nomi *</label>
                        <input type="text" name="name" placeholder="Mahsulot nomini kiriting" required 
                               class="custom-input w-full px-4 py-3 rounded text-base">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-3" style="color: var(--text-primary)">Mahsulot turi *</label>
                        <input type="text" name="mahsulotturi" placeholder="Mahsulot turini kiriting" required 
                               class="custom-input w-full px-4 py-3 rounded text-base">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-3" style="color: var(--text-primary)">Kategoriya *</label>
                        <div class="relative">
                            <select name="category" required class="custom-input w-full px-4 py-3 rounded text-base appearance-none">
                                <option value="">Kategoriyani tanlang</option>
                                <option value="elektronika">Elektronika</option>
                                <option value="uy_jihozlari">Uy jihozlari</option>
                                <option value="kiyim">Kiyim-kechak</option>
                                <option value="avto">Avto ehtiyot qismlar</option>
                                <option value="boshqa">Boshqa</option>
                            </select>
                            <i class="ri-arrow-down-s-line ri-lg absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"></i>
                        </div>
                    </div>

                    <!-- Narxlar -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-primary">Narxlar</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2" style="color: var(--text-primary)">Narx (so'm) *</label>
                                <input type="text" name="narx" placeholder="0" required 
                                       class="custom-input w-full px-4 py-3 rounded text-base">
                            </div>
                        </div>
                    </div>

                    <!-- Manzil ma'lumotlari -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-primary">Manzil ma'lumotlari</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2" style="color: var(--text-primary)">Viloyat *</label>
                                <select name="viloyat" required class="custom-input w-full px-4 py-3 rounded text-base">
                                    <option value="">Viloyatni tanlang</option>
                                    <option value="toshkent">Toshkent</option>
                                    <option value="samarqand">Samarqand</option>
                                    <option value="fargona">Farg'ona</option>
                                    <option value="andijon">Andijon</option>
                                    <option value="namangan">Namangan</option>
                                    <option value="buxoro">Buxoro</option>
                                    <option value="navoiy">Navoiy</option>
                                    <option value="xorazm">Xorazm</option>
                                    <option value="qashqadaryo">Qashqadaryo</option>
                                    <option value="surxondaryo">Surxondaryo</option>
                                    <option value="jizzax">Jizzax</option>
                                    <option value="sirdaryo">Sirdaryo</option>
                                    <option value="qoraqalpogiston">Qoraqalpog'iston</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2" style="color: var(--text-primary)">Tuman/Shahar</label>
                                <input type="text" name="tuman" placeholder="Tuman yoki shahar nomi" 
                                       class="custom-input w-full px-4 py-3 rounded text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2" style="color: var(--text-primary)">Aniq manzil</label>
                                <input type="text" name="manzil" placeholder="Ko'cha, uy raqami" 
                                       class="custom-input w-full px-4 py-3 rounded text-base">
                            </div>
                        </div>
                    </div>

                    <!-- Aloqa ma'lumotlari -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-primary">Aloqa ma'lumotlari</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2" style="color: var(--text-primary)">Telefon raqam</label>
                                <input type="tel" name="telefon" placeholder="+998 XX XXX XX XX" 
                                       class="custom-input w-full px-4 py-3 rounded text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2" style="color: var(--text-primary)">Telegram username</label>
                                <input type="text" name="telegram_username" placeholder="@username" 
                                       class="custom-input w-full px-4 py-3 rounded text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2" style="color: var(--text-primary)">Email</label>
                                <input type="email" name="email" placeholder="email@example.com" 
                                       class="custom-input w-full px-4 py-3 rounded text-base">
                            </div>
                        </div>
                    </div>

                    <!-- Tavsif -->
                    <div>
                        <label class="block text-sm font-semibold mb-3" style="color: var(--text-primary)">Tavsif</label>
                        <textarea name="tavsif" rows="4" placeholder="Mahsulot tavsifini kiriting" 
                                  class="custom-input w-full px-4 py-3 rounded text-base resize-none"></textarea>
                    </div>

                    <!-- Status -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-primary">Status</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-base font-medium" style="color: var(--text-primary)">Aktiv</span>
                                <label class="custom-toggle">
                                    <input type="checkbox" name="aktiv" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-base font-medium" style="color: var(--text-primary)">Sotilgan</span>
                                <label class="custom-toggle">
                                    <input type="checkbox" name="sotilgan">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- O'ng qism - Rasmlar -->
                <div class="space-y-6">
                    <!-- Asosiy rasm -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-primary">Asosiy rasm *</h3>
                        <div class="upload-zone rounded-lg p-8 text-center cursor-pointer" onclick="document.getElementById('asosiyimg').click()">
                            <div id="mainImagePreview" class="hidden">
                                <img id="mainImageImg" class="w-full h-48 object-cover rounded-lg mb-4">
                                <button type="button" onclick="removeMainImage()" class="text-red-500 hover:text-red-700 text-sm font-medium">
                                    <i class="ri-delete-bin-line mr-1"></i>O'chirish
                                </button>
                            </div>
                            <div id="mainImagePlaceholder">
                                <i class="ri-image-add-line ri-3x text-primary mb-4"></i>
                                <p class="text-lg font-medium text-primary mb-2">Asosiy rasm yuklash</p>
                                <p class="text-sm" style="color: var(--text-secondary)">JPG, PNG formatida, maksimal 5MB</p>
                            </div>
                            <input type="file" id="asosiyimg" name="asosiyimg" accept="image/*" class="hidden" onchange="previewMainImage(this)" required>
                        </div>
                    </div>

                    <!-- Qo'shimcha rasmlar -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-primary">Qo'shimcha rasmlar</h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <!-- 1-rasm -->
                            <div class="upload-zone aspect-square rounded-lg p-4 text-center cursor-pointer flex flex-col items-center justify-center" onclick="document.getElementById('birimg').click()">
                                <div id="additionalPreview1" class="hidden w-full h-full">
                                    <img id="additionalImg1" class="w-full h-full object-cover rounded">
                                </div>
                                <div id="additionalPlaceholder1" class="flex flex-col items-center">
                                    <i class="ri-add-line ri-xl text-primary mb-1"></i>
                                    <span class="text-xs" style="color: var(--text-secondary)">1-rasm</span>
                                </div>
                                <input type="file" id="birimg" name="birimg" accept="image/*" class="hidden" onchange="previewAdditionalImage(this, 1)">
                            </div>

                            <!-- 2-rasm -->
                            <div class="upload-zone aspect-square rounded-lg p-4 text-center cursor-pointer flex flex-col items-center justify-center" onclick="document.getElementById('ikkiimg').click()">
                                <div id="additionalPreview2" class="hidden w-full h-full">
                                    <img id="additionalImg2" class="w-full h-full object-cover rounded">
                                </div>
                                <div id="additionalPlaceholder2" class="flex flex-col items-center">
                                    <i class="ri-add-line ri-xl text-primary mb-1"></i>
                                    <span class="text-xs" style="color: var(--text-secondary)">2-rasm</span>
                                </div>
                                <input type="file" id="ikkiimg" name="ikkiimg" accept="image/*" class="hidden" onchange="previewAdditionalImage(this, 2)">
                            </div>

                            <!-- 3-rasm -->
                            <div class="upload-zone aspect-square rounded-lg p-4 text-center cursor-pointer flex flex-col items-center justify-center" onclick="document.getElementById('uchuimg').click()">
                                <div id="additionalPreview3" class="hidden w-full h-full">
                                    <img id="additionalImg3" class="w-full h-full object-cover rounded">
                                </div>
                                <div id="additionalPlaceholder3" class="flex flex-col items-center">
                                    <i class="ri-add-line ri-xl text-primary mb-1"></i>
                                    <span class="text-xs" style="color: var(--text-secondary)">3-rasm</span>
                                </div>
                                <input type="file" id="uchuimg" name="uchuimg" accept="image/*" class="hidden" onchange="previewAdditionalImage(this, 3)">
                            </div>
                        </div>
                    </div>

                    <!-- Qo'shimcha fayl -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-primary">Qo'shimcha fayl</h3>
                        <div class="upload-zone rounded-lg p-6 text-center cursor-pointer" onclick="document.getElementById('toltirish').click()">
                            <div id="filePreview" class="hidden">
                                <i class="ri-file-text-line ri-3x text-primary mb-4"></i>
                                <p id="fileName" class="text-sm font-medium text-primary mb-2"></p>
                                <button type="button" onclick="removeFile()" class="text-red-500 hover:text-red-700 text-sm font-medium">
                                    <i class="ri-delete-bin-line mr-1"></i>O'chirish
                                </button>
                            </div>
                            <div id="filePlaceholder">
                                <i class="ri-file-upload-line ri-3x text-primary mb-4"></i>
                                <p class="text-lg font-medium text-primary mb-2">Fayl yuklash</p>
                                <p class="text-sm" style="color: var(--text-secondary)">PDF, DOC, ZIP formatida</p>
                            </div>
                            <input type="file" id="toltirish" name="toltirish" class="hidden" onchange="previewFile(this)">
                        </div>
                    </div>

                    <!-- Ko'rsatmalar -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-800 mb-2">Eslatmalar:</h4>
                        <ul class="text-sm text-blue-700 space-y-1">
                            <li>• * bilan belgilangan maydonlar majburiy</li>
                            <li>• Asosiy rasm majburiy yuklanadi</li>
                            <li>• Narxni raqamlarda kiriting (masalan: 1000000)</li>
                            <li>• Telegram username @ belgisiz kiriting</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Tugmalar -->
            <div class="flex justify-between pt-8 border-t" style="border-color: var(--border-color);">
                <a href="{% url 'mahsulotlar' %}">
                    <button type="button" class="px-8 py-3 rounded-button border-2 border-primary text-primary hover:bg-primary hover:text-white transition-all duration-300 font-medium whitespace-nowrap">
                        Bekor qilish
                    </button>
                </a>
                <button type="submit" class="px-8 py-3 rounded-button bg-primary text-white hover:bg-secondary transition-all duration-300 font-medium whitespace-nowrap">
                    <i class="ri-save-line mr-2"></i>E'lon qo'shish
                </button>
            </div>
        </form>
    </div>

    {% include 'futter.html' %}

    <script>
        // Tema o'zgartirish
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;
            const themeIcon = themeToggle.querySelector('i');
            let isDarkMode = false;

            themeToggle.addEventListener('click', function() {
                isDarkMode = !isDarkMode;
                if (isDarkMode) {
                    body.classList.remove('light-mode');
                    body.classList.add('dark-mode');
                    themeIcon.className = 'ri-moon-line ri-lg';
                } else {
                    body.classList.remove('dark-mode');
                    body.classList.add('light-mode');
                    themeIcon.className = 'ri-sun-line ri-lg';
                }
            });

            // Toggle tugmalari
            const toggles = document.querySelectorAll('.custom-toggle input[type="checkbox"]');
            toggles.forEach(toggle => {
                toggle.addEventListener('change', function() {
                    const slider = this.nextElementSibling;
                    if (this.checked) {
                        slider.style.backgroundColor = '#8B5CF6';
                    } else {
                        slider.style.backgroundColor = '#ccc';
                    }
                });
            });
        });

        // Rasm yuklash funksiyalari
        function previewMainImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                if (file.size > 5 * 1024 * 1024) {
                    alert('Fayl hajmi 5MB dan katta bo\'lmasligi kerak!');
                    input.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('mainImageImg').src = e.target.result;
                    document.getElementById('mainImagePreview').classList.remove('hidden');
                    document.getElementById('mainImagePlaceholder').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function removeMainImage() {
            document.getElementById('asosiyimg').value = '';
            document.getElementById('mainImagePreview').classList.add('hidden');
            document.getElementById('mainImagePlaceholder').classList.remove('hidden');
        }

        function previewAdditionalImage(input, index) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                if (file.size > 5 * 1024 * 1024) {
                    alert('Fayl hajmi 5MB dan katta bo\'lmasligi kerak!');
                    input.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('additionalImg' + index).src = e.target.result;
                    document.getElementById('additionalPreview' + index).classList.remove('hidden');
                    document.getElementById('additionalPlaceholder' + index).classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function previewFile(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('filePreview').classList.remove('hidden');
                document.getElementById('filePlaceholder').classList.add('hidden');
            }
        }

        function removeFile() {
            document.getElementById('toltirish').value = '';
            document.getElementById('filePreview').classList.add('hidden');
            document.getElementById('filePlaceholder').classList.remove('hidden');
        }

        // Formani yuborishdan oldin tekshirish
        document.querySelector('form').addEventListener('submit', function(e) {
            const requiredFields = this.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.style.borderColor = 'red';
                } else {
                    field.style.borderColor = '';
                }
            });

            if (!isValid) {
                e.preventDefault();
                alert('Iltimos, barcha majburiy maydonlarni to\'ldiring!');
            }
        });
    </script>
</body>
</html>